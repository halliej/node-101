
var chData = {
  "displayName": "The Walt Disney Company",
  "relationshipType": "Ultimate Parent",
  "country": "United States",
  "state": "CA",
  "city": "Burbank",
  "postalCode": "",
  "dOrgCompanyId": "1191",
  "imgUrl": "https://cdn1.devqa.discoverydb.com/F/large/png/7/b/5/0/e/3daa09.png",
  "children": [{
    "displayName": "Hungama TV",
    "relationshipType": "Subsidiary",
    "country": "India",
    "state": "",
    "city": "Mumbai",
    "postalCode": "400013",
    "dOrgCompanyId": "",
    "children": []
  }, {
    "displayName": "Disholder 3, Inc.",
    "relationshipType": "Subsidiary",
    "country": "United States",
    "state": "DE",
    "city": "Wilmington",
    "postalCode": "",
    "dOrgCompanyId": "",
    "children": []
  }, {
    "displayName": "Magical Cruise Company, Limited",
    "relationshipType": "Subsidiary",
    "country": "United Kingdom",
    "state": "",
    "city": "London",
    "postalCode": "",
    "dOrgCompanyId": "",
    "children": []
  }, {
    "displayName": "Steamboat Ventures Asia, L.P.",
    "relationshipType": "Subsidiary",
    "country": "China",
    "state": "",
    "city": "Shanghai",
    "postalCode": "",
    "dOrgCompanyId": "",
    "children": []
  }, {
    "displayName": "BVS Entertainment, Inc.",
    "relationshipType": "Subsidiary",
    "country": "United States",
    "state": "CA",
    "city": "Burbank",
    "postalCode": "",
    "dOrgCompanyId": "",
    "children": []
  }, {
    "displayName": "SuperComm Inc.",
    "relationshipType": "Subsidiary",
    "country": "United States",
    "state": "TX",
    "city": "Dallas",
    "postalCode": "",
    "dOrgCompanyId": "",
    "children": []
  }, {
    "displayName": "Lucasfilm Ltd.",
    "relationshipType": "Subsidiary",
    "country": "United States",
    "state": "CA",
    "city": "San Francisco",
    "postalCode": "",
    "dOrgCompanyId": "",
    "children": []
  }, {
    "displayName": "Disney Cruise Line",
    "relationshipType": "Brand",
    "country": "",
    "state": "",
    "city": "",
    "postalCode": "",
    "dOrgCompanyId": "",
    "children": []
  }, {
    "displayName": "Pixar",
    "relationshipType": "Subsidiary",
    "country": "United States",
    "state": "CA",
    "city": "Emeryville",
    "postalCode": "",
    "dOrgCompanyId": "",
    "children": []
  }, {
    "displayName": "Touchstone",
    "relationshipType": "Brand",
    "country": "",
    "state": "",
    "city": "",
    "postalCode": "",
    "dOrgCompanyId": "",
    "children": []
  }, {
    "displayName": "Playdom, Inc.",
    "relationshipType": "Subsidiary",
    "country": "United States",
    "state": "CA",
    "city": "Mountain View",
    "postalCode": "",
    "dOrgCompanyId": "",
    "children": [{
      "displayName": "Acclaim Games, Inc.",
      "relationshipType": "Subsidiary",
      "country": "United States",
      "state": "CA",
      "city": "Beverly Hills",
      "postalCode": "",
      "dOrgCompanyId": "",
      "children": []
    }]
  }, {
    "displayName": "Walt Disney Parks and Resorts",
    "relationshipType": "Subsidiary",
    "country": "Spain",
    "state": "",
    "city": "Madrid",
    "postalCode": "",
    "dOrgCompanyId": "1157",
    "imgUrl": "https://cdn1.devqa.discoverydb.com/F/large/png/b/9/d/d/1/8d7b6b.png",
    "children": []
  }, {
    "displayName": "ABC",
    "relationshipType": "Subsidiary",
    "country": "United States",
    "state": "NY",
    "city": "New York",
    "postalCode": "",
    "dOrgCompanyId": "2001895",
    "imgUrl": "https://cdn1.devqa.discoverydb.com/F/large/png/9/7/6/4/4/bd49c8.png",
    "children": [{
      "displayName": "American Broadcasting Companies, Inc.",
      "relationshipType": "Subsidiary",
      "country": "United States",
      "state": "CA",
      "city": "Burbank",
      "postalCode": "",
      "dOrgCompanyId": "",
      "children": [{
        "displayName": "KABC-TV Inc.",
        "relationshipType": "Subsidiary",
        "country": "United States",
        "state": "CA",
        "city": "Glendale",
        "postalCode": "",
        "dOrgCompanyId": "",
        "children": []
      }, {
        "displayName": "KGO Television, Inc.",
        "relationshipType": "Subsidiary",
        "country": "United States",
        "state": "CA",
        "city": "San Francisco",
        "postalCode": "",
        "dOrgCompanyId": "",
        "children": []
      }, {
        "displayName": "WLS Television, Inc.",
        "relationshipType": "Subsidiary",
        "country": "United States",
        "state": "IL",
        "city": "Chicago",
        "postalCode": "",
        "dOrgCompanyId": "",
        "children": []
      }, {
        "displayName": "WABC-TV Inc.",
        "relationshipType": "Subsidiary",
        "country": "United States",
        "state": "NY",
        "city": "New York",
        "postalCode": "",
        "dOrgCompanyId": "",
        "children": []
      }, {
        "displayName": "KTRK Television, Inc.",
        "relationshipType": "Subsidiary",
        "country": "United States",
        "state": "TX",
        "city": "Houston",
        "postalCode": "",
        "dOrgCompanyId": "",
        "children": []
      }, {
        "displayName": "KFSN-TV Inc.",
        "relationshipType": "Subsidiary",
        "country": "United States",
        "state": "CA",
        "city": "Fresno",
        "postalCode": "",
        "dOrgCompanyId": "",
        "children": []
      }, {
        "displayName": "WPVI-TV Inc.",
        "relationshipType": "Subsidiary",
        "country": "United States",
        "state": "PA",
        "city": "Philadelphia",
        "postalCode": "",
        "dOrgCompanyId": "",
        "children": []
      }, {
        "displayName": "WTVD-TV Inc.",
        "relationshipType": "Subsidiary",
        "country": "United States",
        "state": "NC",
        "city": "Durham",
        "postalCode": "",
        "dOrgCompanyId": "",
        "children": []
      }]
    }, {
      "displayName": "ESPN",
      "relationshipType": "Division",
      "country": "United States",
      "state": "CT",
      "city": "Bristol",
      "postalCode": "",
      "dOrgCompanyId": "355",
      "imgUrl": "https://cdn1.devqa.discoverydb.com/F/large/png/2/f/3/9/8/c5233a.png",
      "children": [{
        "displayName": "Espnu",
        "relationshipType": "Brand",
        "country": "",
        "state": "",
        "city": "",
        "postalCode": "",
        "dOrgCompanyId": "",
        "children": []
      }, {
        "displayName": "Espn Classic",
        "relationshipType": "Brand",
        "country": "",
        "state": "",
        "city": "",
        "postalCode": "",
        "dOrgCompanyId": "",
        "children": []
      }, {
        "displayName": "B.A.S.S., Inc.",
        "relationshipType": "Subsidiary",
        "country": "United States",
        "state": "FL",
        "city": "Kissimmee",
        "postalCode": "",
        "dOrgCompanyId": "",
        "children": [{
          "displayName": "B.A.S.S. Times",
          "relationshipType": "Division",
          "country": "United States",
          "state": "FL",
          "city": "Lake Buena Vista",
          "postalCode": "",
          "dOrgCompanyId": "",
          "children": []
        }, {
          "displayName": "Bassmaster Magazine",
          "relationshipType": "Division",
          "country": "United States",
          "state": "FL",
          "city": "Celebration",
          "postalCode": "",
          "dOrgCompanyId": "",
          "children": []
        }]
      }, {
        "displayName": "Espn Zone",
        "relationshipType": "Brand",
        "country": "",
        "state": "",
        "city": "",
        "postalCode": "",
        "dOrgCompanyId": "",
        "children": []
      }, {
        "displayName": "X Games",
        "relationshipType": "Brand",
        "country": "",
        "state": "",
        "city": "",
        "postalCode": "",
        "dOrgCompanyId": "",
        "children": []
      }]
    }]
  }, {
    "displayName": "Adventures By Disney",
    "relationshipType": "Subsidiary",
    "country": "United States",
    "state": "FL",
    "city": "Celebration",
    "postalCode": "",
    "dOrgCompanyId": "",
    "children": []
  }, {
    "displayName": "Reedy Creek Improvement District",
    "relationshipType": "Subsidiary",
    "country": "United States",
    "state": "FL",
    "city": "Lake Buena Vista",
    "postalCode": "",
    "dOrgCompanyId": "20115",
    "imgUrl": "https://cdn1.devqa.discoverydb.com/F/large/png/e/e/1/3/a/d1c857.png",
    "children": []
  }, {
    "displayName": "Disney Store",
    "relationshipType": "Subsidiary",
    "country": "United States",
    "state": "CA",
    "city": "Glendale",
    "postalCode": "",
    "dOrgCompanyId": "2064043",
    "children": []
  }, {
    "displayName": "Marvel Entertainment",
    "relationshipType": "Subsidiary",
    "country": "United States",
    "state": "NY",
    "city": "New York",
    "postalCode": "",
    "dOrgCompanyId": "19451",
    "imgUrl": "https://cdn1.devqa.discoverydb.com/F/large/png/3/d/9/f/d/7aac82.png",
    "children": [{
      "displayName": "Cover Concepts Marketing Services LLC",
      "relationshipType": "Division",
      "country": "United States",
      "state": "NY",
      "city": "New York",
      "postalCode": "",
      "dOrgCompanyId": "",
      "children": []
    }]
  }, {
    "displayName": "The Baby Einstein Company, LLC",
    "relationshipType": "Subsidiary",
    "country": "United States",
    "state": "CA",
    "city": "Glendale",
    "postalCode": "",
    "dOrgCompanyId": "",
    "children": []
  }, {
    "displayName": "Hong Kong Disneyland Management Limited",
    "relationshipType": "Subsidiary",
    "country": "China (Hong Kong)",
    "state": "",
    "city": "Hong Kong",
    "postalCode": "",
    "dOrgCompanyId": "",
    "children": []
  }, {
    "displayName": "Hollywood Records Inc.",
    "relationshipType": "Subsidiary",
    "country": "United States",
    "state": "CA",
    "city": "Burbank",
    "postalCode": "",
    "dOrgCompanyId": "",
    "children": []
  }, {
    "displayName": "Magic Kingdom",
    "relationshipType": "Brand",
    "country": "",
    "state": "",
    "city": "",
    "postalCode": "",
    "dOrgCompanyId": "",
    "children": []
  }, {
    "displayName": "Walt Disney World",
    "relationshipType": "Brand",
    "country": "",
    "state": "",
    "city": "",
    "postalCode": "",
    "dOrgCompanyId": "",
    "children": []
  }, {
    "displayName": "Disneyland",
    "relationshipType": "Brand",
    "country": "",
    "state": "",
    "city": "",
    "postalCode": "",
    "dOrgCompanyId": "",
    "children": []
  }, {
    "displayName": "EDL Hotels SCA",
    "relationshipType": "Affiliate",
    "country": "France",
    "state": "",
    "city": "Marne-la-Vallee",
    "postalCode": "",
    "dOrgCompanyId": "",
    "children": []
  }, {
    "displayName": "Walt Disney Studios",
    "relationshipType": "Brand",
    "country": "",
    "state": "",
    "city": "",
    "postalCode": "",
    "dOrgCompanyId": "",
    "children": []
  }, {
    "displayName": "Space Mountain",
    "relationshipType": "Brand",
    "country": "",
    "state": "",
    "city": "",
    "postalCode": "",
    "dOrgCompanyId": "",
    "children": []
  }]
};

var hasDangler = false;
function processData(data) {
  for (var key in data) {
    if (key === 'displayName') {
      var locationString = "";
      if (data.city) { locationString += data.city + ", "; }
      if (data.state) { locationString += data.state; }
      if (!data.state && data.country) { locationString += data.country; }
      data.locationString = locationString;
    } else if (key === 'dOrgCompanyId') {
      if (data[key]) {
        data.profiled = true;
        data.useImage = data['imgUrl'] && data['imgUrl'].trim().length > 0;
      } else {
        data.profiled = false;
        data.useImage = false;
      }
    }
    else if (key === 'relationshipType') {
      switch (data.relationshipType) {
        case 'Ultimate Parent':
          data.treeNodeContentClass = 'ultimateParentCompany';
          data.companyIconColorClass = 'ultimateParentColor';
          break;
        case 'Division':
          data.treeNodeContentClass = 'divisionCompany';
          data.companyIconColorClass = 'divisionColor';
          break;
        case 'Brand':
          data.treeNodeContentClass = 'brandCompany';
          data.companyIconColorClass = 'brandNColor';
          break;
        case 'Subsidiary':
          data.treeNodeContentClass = 'subsidiaryCompany';
          data.companyIconColorClass = 'subsidiaryColor';
          break;
        case 'Affiliate':
          data.treeNodeContentClass = 'affiliateCompany';
          data.companyIconColorClass = 'affiliateColor';
          break;
        default:
          console.log('missing relationshipType');
      }
    }
    else if (key === 'children') {
      var numChildren = data[key].length;
      if (numChildren > 0) {
        if (data.children[numChildren - 1].children.length > 0) {
          data.children[numChildren - 1].dangler = true;
          hasDangler = true;
        }
      }
      var children = data[key];
      for (var i = 0; i < children.length; i++) {
        if (hasDangler) {
          var grandchildren = data.children[children.length - 1].children;
          for (var j = 0; j < grandchildren.length; j++) {
            if (grandchildren[j].children.length > 0) {
              grandchildren[j].dangler = false;
              hasDangler = false;
            }
          }
        }
        processData(children[i]);
      }
    }
  }
  return data;
}


// setLevels(data);
var processedData = processData(chData);
console.log(JSON.stringify(processedData))
